
Running configs.
{'root_path': 'datasets', 'dataset': 'eurosat', 'shots': 16, 'backbone': 'RN50', 'n_prompt_tokens': 4, 'intrinsic_dim': 512, 'budget': 8000, 'bound': 5, 'alpha': 1, 'popsize': 40, 'parallel': False, 'print_every': 50, 'eval_every': 100, 'n': 1, 'batch_size': 256, 'std': 1, 'weight': 0.01, 'train_epoch': 20, 'subsample_classes': 'all', 'seed': 1}

Preparing dataset.
Reading split from /raid0-data/yifan/datasets/eurosat/split_zhou_EuroSAT.json
Creating a 16-shot dataset

Loading visual features and labels from test set.
Initial context: "a photo of a"
Number of context words (tokens): 4
Population Size: 40
Serial Evaluation.
Printing trainable parameters
Printing to verify trainable parameters
name input_param param.shape: torch.Size([40, 512])
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 512/512 [00:07<00:00, 70.29it/s]
/home/yifanyang/miniconda3/envs/vlm/lib/python3.9/site-packages/torch/optim/lr_scheduler.py:224: UserWarning: Detected call of `lr_scheduler.step()` before `optimizer.step()`. In PyTorch 1.1.0 and later, you should call them in the opposite order: `optimizer.step()` before `lr_scheduler.step()`.  Failure to do this will result in PyTorch skipping the first value of the learning rate schedule. See more details at https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate
  warnings.warn(
Steps: 0 	 Acc:48.23456790123457 	 Loss:0
merge the parameter at step 1
[MERGE] prompt_learner id: 130396322033424
[MERGE] zo_trainer.prompt_learner id: 130396322033424
[MERGE] prompt_learner.input_param shape: torch.Size([512])
[MERGE] zo_trainer.prompt_learner.input_param shape: torch.Size([512])
[MERGE] _parameters['input_param'] shape: torch.Size([512])
> /home/yifanyang/tmp/mllm/neurips_code/main_sharpzo.py(165)zo_step()
-> if self.args.prompt_trainer == 'zo-pruned' and (
[('input_param', Parameter containing:
tensor([ 0.1103, -0.1985, -0.0539, -0.0257,  0.0131, -0.0891, -0.0173,  0.0989,
         0.0974, -0.0434, -0.0410, -0.1167,  0.0052, -0.1655, -0.0509,  0.1065,
         0.2345,  0.0139, -0.0230, -0.1096,  0.1269, -0.0333,  0.0941,  0.1365,
        -0.0056, -0.1991, -0.0665, -0.1113,  0.0015, -0.2555, -0.0292, -0.0480,
        -0.0623, -0.1238,  0.0041,  0.1911, -0.0162,  0.0759, -0.0188,  0.0262,
        -0.1273, -0.1541,  0.1622,  0.1552, -0.0295,  0.0792, -0.1555, -0.0866,
         0.0449, -0.1245,  0.0605, -0.1881,  0.0483, -0.0790, -0.0357, -0.1500,
        -0.2494, -0.0523, -0.0122, -0.1237,  0.0720,  0.1984,  0.0144,  0.2367,
        -0.2171,  0.0063,  0.2412, -0.0013, -0.1149,  0.2302,  0.0355,  0.2500,
         0.2034, -0.0721,  0.1388, -0.0145, -0.0882,  0.3056, -0.0241, -0.0947,
        -0.0697,  0.1665,  0.0886, -0.0280, -0.0552,  0.0060, -0.1137,  0.1689,
        -0.1930,  0.1028, -0.0898, -0.0968,  0.1007, -0.0780,  0.0779,  0.0610,
        -0.1491,  0.0655, -0.0938,  0.0025,  0.0421, -0.1379, -0.0633, -0.0362,
        -0.0376, -0.1022, -0.1481, -0.0563, -0.1697, -0.1724,  0.1148,  0.1375,
         0.0154, -0.0086,  0.0241, -0.1097,  0.2451, -0.0543, -0.1880,  0.1006,
        -0.0084,  0.0406,  0.1887, -0.1468,  0.1548,  0.0849,  0.2079,  0.0573,
         0.0330,  0.1647,  0.0698,  0.3223,  0.0329,  0.1370,  0.2103, -0.2001,
         0.0779, -0.1629, -0.0706,  0.0246, -0.1311, -0.1784, -0.1484,  0.0269,
         0.2392,  0.0338,  0.0281, -0.0045, -0.1599, -0.2764,  0.0509, -0.1353,
        -0.0027, -0.1649, -0.1478,  0.2982,  0.1116, -0.0485, -0.2258,  0.0250,
        -0.1694, -0.0120,  0.2130,  0.2089, -0.1402, -0.0166,  0.0886,  0.0237,
        -0.1211, -0.0855,  0.0112, -0.0122,  0.0302, -0.0250,  0.0038, -0.2220,
         0.0831, -0.1546, -0.1601, -0.0242,  0.0591,  0.0148, -0.1837, -0.0744,
        -0.0951, -0.0449, -0.2620, -0.1272,  0.2360,  0.2361,  0.2605, -0.0169,
         0.0658, -0.0630, -0.0550,  0.0934, -0.0142,  0.0708, -0.1420, -0.0984,
         0.0655, -0.0312, -0.0007, -0.2963,  0.1036,  0.0396, -0.0775,  0.1421,
        -0.3936, -0.1090, -0.1374, -0.1658, -0.0709, -0.0482,  0.1024,  0.0258,
         0.1890,  0.2335, -0.1092, -0.0140,  0.2211,  0.0312,  0.0224,  0.0845,
        -0.0542,  0.0262,  0.0575,  0.1204,  0.3038,  0.0736, -0.0754,  0.1199,
        -0.1834,  0.0634,  0.2834, -0.0987,  0.0366,  0.2183, -0.1585,  0.2246,
         0.0345, -0.0421, -0.0773,  0.0099,  0.0352, -0.2752,  0.0421,  0.0425,
        -0.1142, -0.0224,  0.0142,  0.1620, -0.1062,  0.3280,  0.1694, -0.2867,
        -0.0106,  0.0067, -0.0019,  0.1790,  0.0059,  0.1486, -0.1692,  0.0731,
         0.2058, -0.0732, -0.0150, -0.0523, -0.0962, -0.0225, -0.0385,  0.0842,
        -0.1065,  0.3204,  0.0213, -0.1040, -0.1417, -0.0214,  0.0992, -0.1719,
        -0.0297,  0.0259,  0.0160,  0.2363,  0.1036, -0.0796,  0.1535,  0.1519,
         0.1944,  0.4145,  0.0153,  0.1280, -0.1127,  0.0076,  0.0734, -0.0234,
         0.1948,  0.0971,  0.1557, -0.2745, -0.0800,  0.0596,  0.2023, -0.1776,
         0.0334,  0.1886,  0.1283, -0.1193,  0.3246,  0.0978,  0.0065,  0.2728,
        -0.0639,  0.2345,  0.0150,  0.0704,  0.1932,  0.0017, -0.1177,  0.0621,
        -0.1125,  0.1106,  0.0676,  0.0705, -0.0348,  0.0075, -0.1479,  0.2161,
        -0.2245, -0.0081,  0.0059, -0.1431, -0.0422,  0.0764, -0.1017,  0.1458,
        -0.1469, -0.0143,  0.0227,  0.2177,  0.1362,  0.2462, -0.2255, -0.1025,
        -0.1201, -0.1115,  0.0193, -0.0922,  0.3188,  0.0916,  0.0062,  0.0566,
         0.0777, -0.0964, -0.0185, -0.0526,  0.0116,  0.0707,  0.0180,  0.0147,
        -0.2131, -0.0226, -0.0220,  0.0041,  0.1185,  0.0102,  0.0138, -0.0140,
        -0.1058, -0.1167, -0.1712,  0.0685,  0.0849, -0.1250,  0.0265, -0.1646,
        -0.1296,  0.0554,  0.1335,  0.0085, -0.1768,  0.1414, -0.0311,  0.0074,
        -0.1052,  0.2950,  0.0286,  0.0637, -0.1296, -0.1281, -0.2068,  0.1911,
         0.1513,  0.2237,  0.2517, -0.0870,  0.0557, -0.1046, -0.2341,  0.0307,
         0.0658, -0.0564,  0.2233,  0.0252, -0.0185,  0.0176, -0.0290,  0.0179,
         0.1389,  0.0535, -0.0967,  0.1771,  0.1216, -0.0396, -0.1042, -0.2181,
        -0.0140,  0.0920,  0.1731, -0.1956,  0.3848, -0.0747,  0.0040, -0.0135,
         0.2051,  0.0661,  0.1158, -0.0628,  0.2062,  0.1764,  0.0671,  0.1616,
         0.0686, -0.0913, -0.1484,  0.1770, -0.0114, -0.0501,  0.0631,  0.0346,
         0.0561,  0.0049,  0.0177, -0.0496,  0.0450,  0.2190,  0.1083, -0.0076,
         0.0065,  0.0246,  0.0909, -0.1853, -0.4092, -0.1922,  0.0186, -0.1215,
         0.1023, -0.0801,  0.1029,  0.1603, -0.0139, -0.0371, -0.1432,  0.0989,
        -0.3037, -0.1545, -0.0821, -0.0192, -0.0999,  0.1064,  0.0979,  0.1324,
         0.1160, -0.0311, -0.0550,  0.0195,  0.1482,  0.0046, -0.1259,  0.1925,
        -0.0692, -0.0486,  0.1004, -0.1282,  0.0786, -0.0695,  0.0096,  0.0192,
         0.0758, -0.1141, -0.0188,  0.1174, -0.0244,  0.0933, -0.2830,  0.2403,
         0.1650, -0.0982, -0.0444,  0.1685, -0.0602, -0.0070,  0.0918, -0.1793,
         0.0644, -0.2188,  0.1068, -0.0819,  0.0698, -0.0965,  0.0903,  0.1098],
       device='cuda:0', requires_grad=True))]
*** AttributeError: 'list' object has no attribute 'shape'
*** AttributeError: 'tuple' object has no attribute 'shape'
torch.Size([512])
